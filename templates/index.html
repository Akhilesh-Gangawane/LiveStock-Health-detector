{% extends "layout.html" %}

{% block content %}
<div class="row">
    <div class="col-lg-10 mx-auto">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0"><i class="fas fa-stethoscope me-2"></i>Animal Health Assessment</h4>
            </div>
            <div class="card-body">
                <form id="predictionForm" action="/predict" method="POST">
                    
                    <!-- Animal Basic Information -->
                    <div class="mb-4">
                        <h5 class="text-primary mb-3"><i class="fas fa-info-circle me-2"></i>Basic Information</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label">Animal Type *</label>
                                <select class="form-select" id="animal_type" name="animal_type" required>
                                    <option value="">Select Animal Type</option>
                                    {% for animal in animals %}
                                        <option value="{{ animal }}">{{ animal }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Breed *</label>
                                <select class="form-select" id="breed" name="breed" required>
                                    <option value="">First select animal type</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row mt-3">
                            <div class="col-md-3">
                                <label class="form-label">Age (years) *</label>
                                <input type="number" class="form-control" name="age" step="0.1" min="0" max="50" required value="5">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Gender *</label>
                                <select class="form-select" name="gender" required>
                                    <option value="">Select</option>
                                    <option value="Male" selected>Male</option>
                                    <option value="Female">Female</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Weight (kg) *</label>
                                <input type="number" class="form-control" name="weight" step="0.1" min="0" required value="25">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Duration (days) *</label>
                                <input type="number" class="form-control" name="duration" min="0" required value="3">
                            </div>
                        </div>
                    </div>

                    <!-- Symptoms section -->
                    <div class="mb-4">
                        <h5 class="text-primary mb-3"><i class="fas fa-heartbeat me-2"></i>Symptoms</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Symptom 1 *</label>
                                <select class="form-select" name="symptom1" required>
                                    <option value="">Select Symptom</option>
                                    {% for symptom in symptoms %}
                                        <option value="{{ symptom }}" {% if symptom == 'Cough' %}selected{% endif %}>{{ symptom }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Symptom 2 *</label>
                                <select class="form-select" name="symptom2" required>
                                    <option value="">Select Symptom</option>
                                    {% for symptom in symptoms %}
                                        <option value="{{ symptom }}" {% if symptom == 'Lethargy' %}selected{% endif %}>{{ symptom }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Symptom 3 *</label>
                                <select class="form-select" name="symptom3" required>
                                    <option value="">Select Symptom</option>
                                    {% for symptom in symptoms %}
                                        <option value="{{ symptom }}" {% if symptom == 'Loss of appetite' %}selected{% endif %}>{{ symptom }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Symptom 4 *</label>
                                <select class="form-select" name="symptom4" required>
                                    <option value="">Select Symptom</option>
                                    {% for symptom in symptoms %}
                                        <option value="{{ symptom }}" {% if symptom == 'Nasal discharge' %}selected{% endif %}>{{ symptom }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        
                        <!-- Updated Checkbox symptoms with all symptoms -->
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="appetite_loss" value="yes" id="appetite_loss" checked>
                                    <label class="form-check-label" for="appetite_loss">Appetite Loss</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="vomiting" value="yes" id="vomiting">
                                    <label class="form-check-label" for="vomiting">Vomiting</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="diarrhea" value="yes" id="diarrhea">
                                    <label class="form-check-label" for="diarrhea">Diarrhea</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="coughing" value="yes" id="coughing" checked>
                                    <label class="form-check-label" for="coughing">Coughing</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="labored_breathing" value="yes" id="labored_breathing" checked>
                                    <label class="form-check-label" for="labored_breathing">Labored Breathing</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="nasal_discharge" value="yes" id="nasal_discharge" checked>
                                    <label class="form-check-label" for="nasal_discharge">Nasal Discharge</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="lameness" value="yes" id="lameness">
                                    <label class="form-check-label" for="lameness">Lameness</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="skin_lesions" value="yes" id="skin_lesions">
                                    <label class="form-check-label" for="skin_lesions">Skin Lesions</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="eye_discharge" value="yes" id="eye_discharge">
                                    <label class="form-check-label" for="eye_discharge">Eye Discharge</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Vital Signs -->
                    <div class="mb-4">
                        <h5 class="text-primary mb-3"><i class="fas fa-thermometer-half me-2"></i>Vital Signs</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label">Body Temperature (Â°C) *</label>
                                <input type="number" class="form-control" name="body_temperature" step="0.1" min="30" max="45" required value="39.8">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Heart Rate (BPM) *</label>
                                <input type="number" class="form-control" name="heart_rate" min="20" max="300" required value="110">
                            </div>
                        </div>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <span class="btn-content">
                                <i class="fas fa-search me-2"></i>
                                Predict Disease
                            </span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Inline JavaScript as backup -->
<script>
console.log('Inline script running...');

document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM Content Loaded - inline script');
    
    const animalSelect = document.getElementById('animal_type');
    const breedSelect = document.getElementById('breed');
    
    if (animalSelect && breedSelect) {
        console.log('Found form elements');
        
        animalSelect.addEventListener('change', function() {
            const animalType = this.value;
            console.log('Animal changed to:', animalType);
            
            if (animalType) {
                breedSelect.innerHTML = '<option value="">Loading breeds...</option>';
                
                // Simple fetch call
                fetch('/get_breeds/' + animalType)
                    .then(response => response.json())
                    .then(breeds => {
                        console.log('Received breeds:', breeds);
                        breedSelect.innerHTML = '<option value="">Select Breed</option>';
                        breeds.forEach(breed => {
                            const option = document.createElement('option');
                            option.value = breed;
                            option.textContent = breed;
                            breedSelect.appendChild(option);
                        });
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        breedSelect.innerHTML = '<option value="">Error loading breeds</option>';
                    });
            } else {
                breedSelect.innerHTML = '<option value="">First select animal type</option>';
            }
        });
        
        // Auto-select Dog for testing
        setTimeout(() => {
            animalSelect.value = 'Dog';
            animalSelect.dispatchEvent(new Event('change'));
        }, 500);
    }
});
</script>

{% endblock %}